# MCP Server Configuration
# ========================
# Define external MCP servers that Renfield connects to as a client.
# Each server exposes tools that become available to the Agent Loop.
#
# Environment variable substitution:
#   ${VAR}           — Requires VAR to be set
#   ${VAR:-default}  — Uses "default" if VAR is not set
#
# Transport types:
#   streamable_http  — Modern MCP transport (default)
#   sse              — Server-Sent Events (legacy)
#   stdio            — Subprocess with stdin/stdout (requires Node.js)
#
# Examples:
#   Each server can define bilingual examples for the LLM intent prompt.
#   These help the LLM recognize when to use a server's tools.
#   examples:
#     de: ["Beispiel-Anfrage auf Deutsch"]
#     en: ["Example query in English"]
#
# prompt_tools:
#   Controls which tools appear in the LLM intent prompt.
#   Only listed tools are shown — all tools remain available for execution.
#   Omit this field to show all tools of a server in the prompt.
#   prompt_tools: [tool_name_1, tool_name_2]

servers:
  # --- Open-Meteo MCP Server ---
  # Replaces: plugins/weather.yaml
  # npm: open-meteo-mcp-server
  # No API key required — uses the free Open-Meteo API
  - name: weather
    transport: stdio
    command: npx
    args: ["-y", "open-meteo-mcp-server"]
    enabled: "${WEATHER_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.weather.weather_forecast
    # Only show weather_forecast in prompt — geocoding is handled
    # automatically by _geocode_location_arguments() in mcp_client.py
    prompt_tools:
      - weather_forecast
    examples:
      de:
        - "Wie wird das Wetter morgen?"
        - "Wettervorhersage für Berlin"
      en:
        - "What's the weather tomorrow?"
        - "Weather forecast for Berlin"

  # --- SearXNG MCP Server ---
  # Replaces: plugins/search.yaml
  # npm: @kevinwatt/mcp-server-searxng
  # Requires: SEARXNG_URL env var
  - name: search
    transport: stdio
    command: npx
    args: ["-y", "@kevinwatt/mcp-server-searxng"]
    enabled: "${SEARCH_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.search.web_search
    # No prompt_tools filter — search has only 1 tool
    examples:
      de:
        - "Suche im Web nach Python Tutorials"
        - "Was kostet ein Tesla Model 3?"
      en:
        - "Search the web for Python tutorials"
        - "What does a Tesla Model 3 cost?"

  # --- NewsAPI MCP Server ---
  # Replaces: plugins/news.yaml
  # npm: mcp-newsapi
  # Requires: NEWSAPI_KEY env var
  - name: news
    transport: stdio
    command: npx
    args: ["-y", "mcp-newsapi"]
    enabled: "${NEWS_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.news.search_articles
    prompt_tools:
      - search_articles
      - get_top_headlines
    examples:
      de:
        - "Was sind die aktuellen Nachrichten?"
        - "Nachrichten über KI"
      en:
        - "What are the latest news?"
        - "News about AI"

  # --- Jellyfin MCP Server ---
  # Replaces: plugins/jellyfin.yaml
  # npm: jellyfin-suggestion-mcp
  # Requires env vars (mapped from Renfield config):
  #   JELLYFIN_BASE_URL  ← same as JELLYFIN_URL
  #   JELLYFIN_TOKEN     ← same as JELLYFIN_API_KEY
  #   JELLYFIN_USER_ID   ← optional
  - name: jellyfin
    transport: stdio
    command: npx
    args: ["-y", "jellyfin-suggestion-mcp"]
    enabled: "${JELLYFIN_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.jellyfin.list_items
    prompt_tools:
      - list_items
      - search_items
    examples:
      de:
        - "Welche Filme habe ich?"
        - "Zeige meine Serien"
      en:
        - "What movies do I have?"
        - "Show my series"

  # --- n8n MCP Server ---
  # npm: mcp-n8n
  # Requires: N8N_BASE_URL, N8N_API_KEY env vars
  # Get API key from: n8n → Settings → API → Create API Key
  - name: n8n
    transport: stdio
    command: npx
    args: ["-y", "mcp-n8n"]
    enabled: "${N8N_MCP_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.n8n.n8n_list_workflows_summary
    prompt_tools:
      - n8n_list_workflows_summary
      - n8n_activate_workflow
      - n8n_deactivate_workflow
      - n8n_get_workflow
      - n8n_list_executions
    examples:
      de:
        - "Starte den Backup-Workflow"
        - "Liste meine Workflows"
      en:
        - "Start the backup workflow"
        - "List my workflows"

  # --- Paperless-NGX MCP Server ---
  # Custom Python MCP server with compact responses and ID resolution.
  # Replaces @nloui/paperless-mcp (which returned full OCR content per doc).
  # Requires: PAPERLESS_API_URL, PAPERLESS_API_TOKEN env vars
  # Get API token from: Paperless-NGX → Profile → Auth Tokens
  - name: paperless
    transport: stdio
    command: python
    args: ["-m", "renfield_mcp_paperless"]
    enabled: "${PAPERLESS_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.paperless.search_documents
    prompt_tools:
      - search_documents
    examples:
      de:
        - "Suche nach Rechnungen in Paperless"
        - "Finde Dokumente von Telekom"
      en:
        - "Search for invoices in Paperless"
        - "Find documents from Telekom"

  # --- Home Assistant MCP Server ---
  # Uses HA's built-in MCP server at /api/mcp
  # Requires: MCP Server integration enabled in HA
  - name: homeassistant
    transport: streamable_http
    url: "${HOME_ASSISTANT_URL}/api/mcp"
    auth_token_env: HOME_ASSISTANT_TOKEN
    enabled: "${HA_MCP_ENABLED:-false}"
    refresh_interval: 600
    example_intent: mcp.homeassistant.HassTurnOn
    prompt_tools:
      - HassTurnOn
      - HassTurnOff
      - HassGetState
      - HassSetValue
      - HassLightSet
    examples:
      de:
        - "Schalte das Licht im Wohnzimmer ein"
        - "Wie warm ist es im Büro?"
      en:
        - "Turn on the living room light"
        - "How warm is it in the office?"
