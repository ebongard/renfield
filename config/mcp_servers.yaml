# MCP Server Configuration
# ========================
# Define external MCP servers that Renfield connects to as a client.
# Each server exposes tools that become available to the Agent Loop.
#
# Environment variable substitution:
#   ${VAR}           — Requires VAR to be set
#   ${VAR:-default}  — Uses "default" if VAR is not set
#
# Transport types:
#   streamable_http  — Modern MCP transport (default)
#   sse              — Server-Sent Events (legacy)
#   stdio            — Subprocess with stdin/stdout (requires Node.js)
#
# Examples:
#   Each server can define bilingual examples for the LLM intent prompt.
#   These help the LLM recognize when to use a server's tools.
#   examples:
#     de: ["Beispiel-Anfrage auf Deutsch"]
#     en: ["Example query in English"]
#
# prompt_tools:
#   Controls which tools appear in the LLM intent prompt.
#   Only listed tools are shown — all tools remain available for execution.
#   Omit this field to show all tools of a server in the prompt.
#   prompt_tools: [tool_name_1, tool_name_2]

servers:
  # --- Open-Meteo Weather MCP Server ---
  # Custom Python MCP server with location-based API (no lat/lon needed).
  # GitHub: https://github.com/ebongard/renfield_mcp_weather
  # No API key required — uses the free Open-Meteo API
  - name: weather
    transport: stdio
    command: python
    args: ["-m", "renfield_mcp_weather"]
    enabled: "${WEATHER_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.weather.get_weather
    # Only show main weather tool in prompt (17 tools total available)
    prompt_tools:
      - get_weather
    examples:
      de:
        - "Wie wird das Wetter morgen?"
        - "Wettervorhersage für Berlin"
      en:
        - "What's the weather tomorrow?"
        - "Weather forecast for Berlin"

  # --- SearXNG MCP Server ---
  # Replaces: plugins/search.yaml
  # npm: @kevinwatt/mcp-server-searxng
  # Requires: SEARXNG_URL env var
  - name: search
    transport: stdio
    command: npx
    args: ["-y", "@kevinwatt/mcp-server-searxng"]
    enabled: "${SEARCH_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.search.web_search
    # No prompt_tools filter — search has only 1 tool
    env:
      SEARXNG_INSTANCES: "${SEARXNG_INSTANCES:-http://localhost:8080}"
    examples:
      de:
        - "Suche im Web nach Python Tutorials"
        - "Was kostet ein Tesla Model 3 aktuell?"
      en:
        - "Search the web for Python tutorials"
        - "What does a Tesla Model 3 cost right now?"

  # --- NewsAPI MCP Server ---
  # Replaces: plugins/news.yaml
  # npm: mcp-newsapi
  # Requires: NEWSAPI_KEY env var
  - name: news
    transport: stdio
    command: npx
    args: ["-y", "mcp-newsapi"]
    enabled: "${NEWS_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.news.search_articles
    env:
      NEWSAPI_KEY: "${NEWSAPI_KEY:-}"
    prompt_tools:
      - search_articles
      - get_top_headlines
    examples:
      de:
        - "Was sind die aktuellen Nachrichten?"
        - "Nachrichten über KI"
      en:
        - "What are the latest news?"
        - "News about AI"

  # --- Jellyfin MCP Server ---
  # Custom Python MCP server with 13 specialized tools for Jellyfin.
  # Replaces: jellyfin-suggestion-mcp npm package + plugins/jellyfin.yaml
  # Requires: JELLYFIN_URL, JELLYFIN_API_KEY, JELLYFIN_USER_ID env vars
  - name: jellyfin
    transport: stdio
    command: python
    args: ["-m", "renfield_mcp_jellyfin"]
    enabled: "${JELLYFIN_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.jellyfin.search_media
    env:
      JELLYFIN_URL: "${JELLYFIN_URL:-}"
      JELLYFIN_API_KEY: "${JELLYFIN_API_KEY:-}"
      JELLYFIN_USER_ID: "${JELLYFIN_USER_ID:-}"
    prompt_tools:
      - search_media
      - list_albums
      - list_artists
      - list_movies
      - list_series
      - library_stats
    examples:
      de:
        - "Suche Musik von Queen"
        - "Zeige meine Alben"
        - "Welche Filme habe ich?"
        - "Zeige meine Serien"
      en:
        - "Search music by Queen"
        - "Show my albums"
        - "What movies do I have?"
        - "Show my series"

  # --- n8n MCP Server (Workflow Builder + Node Catalog) ---
  # npm: n8n-mcp (czlonkowski/n8n-mcp)
  # Provides: Workflow CRUD, node catalog (1,084+ nodes),
  #           template search (2,709 templates), validation + auto-fix
  # Requires: N8N_API_URL, N8N_API_KEY env vars
  # Get API key from: n8n → Settings → API → Create API Key
  - name: n8n
    transport: stdio
    command: npx
    args: ["-y", "n8n-mcp"]
    enabled: "${N8N_MCP_ENABLED:-false}"
    env:
      N8N_API_URL: "${N8N_API_URL:-}"
      N8N_API_KEY: "${N8N_API_KEY:-}"
      N8N_MCP_TELEMETRY_DISABLED: "true"
      MCP_MODE: "stdio"
      LOG_LEVEL: "error"
    refresh_interval: 300
    example_intent: mcp.n8n.n8n_list_workflows
    prompt_tools:
      # Workflow Management
      - n8n_list_workflows
      - n8n_get_workflow
      - n8n_create_workflow
      - n8n_update_full_workflow
      - n8n_deploy_template
      # Execution
      - n8n_test_workflow
      - n8n_executions
      # Node Catalog
      - search_nodes
      - get_node
      - search_templates
      - get_template
      # Validation
      - n8n_validate_workflow
      - n8n_autofix_workflow
    examples:
      de:
        - "Erstell einen Workflow der jeden Montag das Wetter per Telegram schickt"
        - "Liste meine n8n Workflows"
        - "Welche n8n Nodes gibt es fuer Telegram?"
      en:
        - "Create a workflow that sends weather via Telegram every Monday"
        - "List my n8n workflows"
        - "What n8n nodes are available for Telegram?"

  # --- Paperless-NGX MCP Server ---
  # Custom Python MCP server with compact responses and ID resolution.
  # Replaces @nloui/paperless-mcp (which returned full OCR content per doc).
  # Requires: PAPERLESS_API_URL, PAPERLESS_API_TOKEN env vars
  # Get API token from: Paperless-NGX → Profile → Auth Tokens
  - name: paperless
    transport: stdio
    command: python
    args: ["-m", "renfield_mcp_paperless"]
    enabled: "${PAPERLESS_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.paperless.search_documents
    env:
      PAPERLESS_API_URL: "${PAPERLESS_API_URL:-}"
      PAPERLESS_API_TOKEN: "${PAPERLESS_API_TOKEN:-}"
    prompt_tools:
      - search_documents
      - upload_document
    examples:
      de:
        - "Suche nach Rechnungen in Paperless"
        - "Finde Dokumente von Telekom"
        - "Sende dieses Dokument an Paperless"
      en:
        - "Search for invoices in Paperless"
        - "Find documents from Telekom"
        - "Send this document to Paperless"

  # --- Email MCP Server ---
  # Custom Python MCP server for multi-account email (IMAP/SMTP).
  # Requires: MAIL_ACCOUNTS_CONFIG env var pointing to YAML config file
  # See: https://github.com/ebongard/renfield-mcp-mail
  - name: email
    transport: stdio
    command: python
    args: ["-m", "renfield_mcp_mail"]
    enabled: "${EMAIL_MCP_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.email.search_emails
    env:
      MAIL_ACCOUNTS_CONFIG: "${MAIL_ACCOUNTS_CONFIG:-/config/mail_accounts.yaml}"
      MAIL_REGFISH_PASSWORD: "${MAIL_REGFISH_PASSWORD:-}"
    prompt_tools:
      - list_accounts
      - search_emails
      - read_email
      - send_email
    examples:
      de:
        - "Zeige mir ungelesene Emails"
        - "Suche Emails von Amazon"
        - "Sende eine Email an max@example.com"
      en:
        - "Show unread emails"
        - "Search emails from Amazon"
        - "Send an email to max@example.com"

  # --- Google Calendar MCP Server (via n8n) ---
  # Uses n8n MCP Server Trigger workflow as calendar bridge.
  # Requires: n8n "Calendar MCP Server" workflow active
  - name: calendar
    transport: sse
    url: "${CALENDAR_MCP_URL:-http://n8n:5678/mcp/calendar/sse}"
    enabled: "${CALENDAR_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.calendar.SearchEvent
    prompt_tools:
      - SearchEvent
      - CreateEvent
    examples:
      de:
        - "Was steht heute in meinem Kalender?"
        - "Erstelle einen Termin morgen um 14 Uhr: Zahnarzt"
        - "Bin ich morgen Nachmittag frei?"
        - "Wann ist mein nächster Termin?"
      en:
        - "What's on my calendar today?"
        - "Create an appointment tomorrow at 2 PM: Dentist"
        - "Am I free tomorrow afternoon?"

  # --- Home Assistant MCP Server ---
  # Uses HA's built-in MCP server at /api/mcp
  # Requires: MCP Server integration enabled in HA
  - name: homeassistant
    transport: streamable_http
    url: "${HOME_ASSISTANT_URL}/api/mcp"
    auth_token_env: HOME_ASSISTANT_TOKEN
    enabled: "${HA_MCP_ENABLED:-false}"
    refresh_interval: 600
    example_intent: mcp.homeassistant.GetLiveContext
    prompt_tools:
      - HassTurnOn
      - HassTurnOff
      - HassLightSet
      - GetLiveContext
      - HassSetPosition
      - HassMediaSearchAndPlay
      - HassSetVolume
    examples:
      de:
        - "Schalte das Licht im Wohnzimmer ein"
        - "Wie warm ist es im Büro?"
      en:
        - "Turn on the living room light"
        - "How warm is it in the office?"
