name: jellyfin
version: 1.0.0
description: Musik-Streaming von Jellyfin Media Server (DLNA/UPnP)
author: Renfield Team
enabled_var: JELLYFIN_ENABLED

config:
  url: JELLYFIN_URL
  api_key: JELLYFIN_API_KEY
  additional:
    user_id: JELLYFIN_USER_ID

intents:
  - name: jellyfin.search_music
    description: Suche nach Musik (Songs, Alben, Künstler) in der Jellyfin-Bibliothek
    parameters:
      - name: query
        type: string
        required: true
        description: Suchbegriff (Titel, Künstler oder Album)
      - name: type
        type: string
        required: false
        default: Audio
        enum: [Audio, MusicAlbum, MusicArtist]
        description: Typ des gesuchten Inhalts
      - name: limit
        type: integer
        required: false
        default: 10
        description: Anzahl der Ergebnisse (1-50)
    examples:
      - "Suche nach Musik von Queen"
      - "Finde das Album Dark Side of the Moon"
      - "Suche den Song Bohemian Rhapsody"
      - "Zeige mir Alben von Pink Floyd"
      - "Welche Musik habe ich von Mozart?"
    api:
      method: GET
      url: "{config.url}/Items?searchTerm={params.query}&IncludeItemTypes={params.type}&Recursive=true&Limit={params.limit}&Fields=Overview,Genres,Artists,AlbumArtist,Album&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 10
      response_mapping:
        items: "Items"
        total_count: "TotalRecordCount"

  - name: jellyfin.list_albums
    description: Liste alle Musikalben in der Bibliothek auf
    parameters:
      - name: limit
        type: integer
        required: false
        default: 50
        description: Anzahl der Ergebnisse
    examples:
      - "Zeige mir alle Alben"
      - "Liste meine Rock-Alben auf"
      - "Welche Alben habe ich?"
      - "Zeige neue Alben"
      - "Zufällige Alben anzeigen"
    api:
      method: GET
      url: "{config.url}/Users/{config.user_id}/Items?IncludeItemTypes=MusicAlbum&Recursive=true&Limit={params.limit}&SortBy=SortName&SortOrder=Ascending&Fields=Overview,Genres,Artists,AlbumArtist&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 10
      response_mapping:
        albums: "Items"
        total: "TotalRecordCount"

  - name: jellyfin.list_artists
    description: Liste alle Künstler in der Musikbibliothek auf
    parameters: []
    examples:
      - "Zeige mir alle Künstler"
      - "Welche Künstler habe ich?"
      - "Liste alle Interpreten auf"
    api:
      method: GET
      url: "{config.url}/Artists?Limit=50&Fields=Overview,Genres&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 10
      response_mapping:
        artists: "Items"
        total: "TotalRecordCount"

  - name: jellyfin.get_album_tracks
    description: Zeige alle Tracks eines Albums
    parameters:
      - name: album_id
        type: string
        required: true
        description: Jellyfin Album-ID
    examples:
      - "Zeige die Songs des Albums"
      - "Welche Tracks sind auf dem Album?"
      - "Liste die Lieder des Albums"
    api:
      method: GET
      url: "{config.url}/Users/{config.user_id}/Items?ParentId={params.album_id}&IncludeItemTypes=Audio&SortBy=IndexNumber&Fields=Overview,Genres,Artists,Album,RunTimeTicks&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 10
      response_mapping:
        tracks: "Items"
        total: "TotalRecordCount"

  - name: jellyfin.get_artist_albums
    description: Zeige alle Alben eines Künstlers
    parameters:
      - name: artist_id
        type: string
        required: true
        description: Jellyfin Künstler-ID
    examples:
      - "Zeige alle Alben von diesem Künstler"
      - "Welche Alben hat der Künstler?"
    api:
      method: GET
      url: "{config.url}/Users/{config.user_id}/Items?ArtistIds={params.artist_id}&IncludeItemTypes=MusicAlbum&Recursive=true&SortBy=PremiereDate&SortOrder=Descending&Fields=Overview,Genres&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 10
      response_mapping:
        albums: "Items"
        total: "TotalRecordCount"

  - name: jellyfin.get_genres
    description: Liste alle Musik-Genres in der Bibliothek
    parameters: []
    examples:
      - "Welche Genres habe ich?"
      - "Zeige alle Musikgenres"
      - "Liste Musikrichtungen auf"
    api:
      method: GET
      url: "{config.url}/MusicGenres?Limit=50&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 10
      response_mapping:
        genres: "Items"
        total: "TotalRecordCount"

  - name: jellyfin.get_recent
    description: Zeige kürzlich hinzugefügte Musik (Alben)
    parameters: []
    examples:
      - "Zeige neue Musik"
      - "Was wurde zuletzt hinzugefügt?"
      - "Neue Alben anzeigen"
      - "Kürzlich hinzugefügte Musik"
    api:
      method: GET
      url: "{config.url}/Users/{config.user_id}/Items/Latest?IncludeItemTypes=MusicAlbum&Limit=20&Fields=Overview,Genres,Artists,AlbumArtist,Album&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 10
      response_mapping:
        items: "$"

  - name: jellyfin.get_favorites
    description: Zeige Lieblings-Musik (mit Herz markiert)
    parameters: []
    examples:
      - "Zeige meine Lieblingsmusik"
      - "Meine favorisierten Songs"
      - "Lieblings-Alben anzeigen"
      - "Welche Musik mag ich?"
    api:
      method: GET
      url: "{config.url}/Users/{config.user_id}/Items?IncludeItemTypes=Audio,MusicAlbum&Recursive=true&Filters=IsFavorite&Limit=50&Fields=Overview,Genres,Artists,Album&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 10
      response_mapping:
        favorites: "Items"
        total: "TotalRecordCount"

  - name: jellyfin.get_playlists
    description: Liste alle Musik-Playlists
    parameters: []
    examples:
      - "Zeige meine Playlists"
      - "Welche Playlisten habe ich?"
      - "Liste alle Wiedergabelisten"
    api:
      method: GET
      url: "{config.url}/Users/{config.user_id}/Items?IncludeItemTypes=Playlist&Recursive=true&Limit=30&Fields=Overview,ChildCount&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 10
      response_mapping:
        playlists: "Items"
        total: "TotalRecordCount"

  - name: jellyfin.get_stream_url
    description: Hole die Streaming-URL für einen Track
    parameters:
      - name: item_id
        type: string
        required: true
        description: Jellyfin Item-ID des Tracks
    examples:
      - "Gib mir den Stream-Link"
      - "Streaming-URL für diesen Song"
    api:
      method: GET
      url: "{config.url}/Items/{params.item_id}?Fields=MediaSources,Path&api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 5
      response_mapping:
        id: "Id"
        name: "Name"
        stream_url: "MediaSources[0].Path"
        container: "MediaSources[0].Container"

  - name: jellyfin.library_stats
    description: Zeige Statistiken der Musikbibliothek
    parameters: []
    examples:
      - "Wie viel Musik habe ich?"
      - "Statistiken meiner Musiksammlung"
      - "Bibliothek-Übersicht"
    api:
      method: GET
      url: "{config.url}/Items/Counts?api_key={config.api_key}"
      headers:
        Accept: "application/json"
      timeout: 5
      response_mapping:
        songs: "SongCount"
        albums: "AlbumCount"
        artists: "ArtistCount"
        music_videos: "MusicVideoCount"

error_mappings:
  - code: 401
    message: "Jellyfin-Authentifizierung fehlgeschlagen. Bitte JELLYFIN_API_KEY überprüfen."
  - code: 403
    message: "Zugriff verweigert. Der API-Key hat keine Berechtigung für diese Aktion."
  - code: 404
    message: "Element nicht gefunden. Die ID existiert nicht in der Bibliothek."
  - code: 500
    message: "Jellyfin-Server Fehler. Bitte Server-Status prüfen."
  - code: 503
    message: "Jellyfin-Server nicht erreichbar. Ist der Server gestartet?"

rate_limit: 120
