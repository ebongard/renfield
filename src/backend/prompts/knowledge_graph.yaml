# Knowledge Graph Extraction Prompts
# Used by KnowledgeGraphService.extract_and_save() to extract
# entities and relations from conversation exchanges.

de:
  extraction_system: "Du extrahierst Entitaeten und Relationen aus Dialogen. Antworte NUR mit einem JSON-Objekt. Keine Nummern, IDs, URLs oder OCR-Artefakte als Entitaeten. Nur Entitaeten mit konkretem Eigennamen."

  extraction_prompt: |
    Analysiere den folgenden Dialog und extrahiere benannte Entitaeten und ihre Beziehungen.

    Nur KONKRETE, BENANNTE Entitaeten extrahieren — mit echtem Namen oder Titel:
    - Personen (vollstaendiger Name oder Spitzname, NICHT generische Rollen)
    - Orte (Staedte, Laender, Gebaeude — mit konkretem Namen)
    - Organisationen (Firmen, Vereine — mit konkretem Namen)
    - Dinge: konkrete Produkte MIT Eigenname: "iPhone 15", "Tesla Model 3" — NICHT generische Begriffe wie "Handy", "Auto", "Flatrate", "Messstellenbetrieb"
    - Ereignisse: konkrete, benannte Ereignisse: "Oktoberfest 2024", "Weihnachten 2025" — NICHT generische Zeitangaben wie "Maerz 2013"
    - Konzepte: NUR persoenliche Hobbys, Studienfaecher, Berufsbezeichnungen — NICHT Dokumentfelder oder juristische Begriffe

    RELATIONEN extrahieren:
    - Beziehungen zwischen Entitaeten ("wohnt_in", "arbeitet_bei", "mag", "besitzt", "kennt", "ist_verheiratet_mit")
    - Nur Relationen die EXPLIZIT im Dialog erwaehnt werden
    - confidence: 0.5-1.0 (wie sicher ist die Relation)

    IGNORIERE (NIEMALS als Entitaet extrahieren):
    - Einmalige Befehle ("Schalte das Licht ein")
    - Smalltalk ohne benannte Entitaeten
    - Informationen die der Assistent gegeben hat (nur Fakten VOM Benutzer)
    - Generische Rollen OHNE konkreten Namen ("Kunde", "Sachbearbeiter", "Vermittler", "Berater", "Bediener")
    - Nummern, IDs, Referenzcodes, Vertragsnummern, Aktenzeichen
    - URLs, E-Mail-Adressen, Telefonnummern
    - Datumsangaben als Entitaeten (nur in Beschreibungen verwenden)
    - KEINE einzelnen deutschen Substantive die Dokumentfelder beschreiben: z.B. "Inkasso", "Flatrate", "Messstellenbetrieb", "Mahngebuehren", "Zahlungsbedingungen"
    - KEINE Geldbetraege oder Waehrungsangaben ("100 EUR", "0,04 Euro")
    - KEINE generischen Geschaeftsbegriffe ("Leistungserbringer", "Zahlungsdienstleister", "Vertragsnummer", "Abrechnungszeitraum")

    Dialog:
    User: {user_message}
    Assistent: {assistant_response}

    Antworte als JSON-Objekt (leere Arrays wenn nichts relevant):
    {{
      "entities": [{{"name": "...", "type": "person|place|organization|thing|event|concept", "description": "..."}}],
      "relations": [{{"subject": "...", "predicate": "...", "object": "...", "confidence": 0.8}}]
    }}

  query_entities_system: "Extrahiere Entitaetsnamen aus Fragen. Antworte NUR mit einem JSON-Array von Strings."

  query_entities_prompt: |
    Welche konkreten Personen, Orte, Organisationen oder Dinge werden in dieser Frage namentlich erwaehnt?
    Nur Eigennamen extrahieren, keine generischen Begriffe.

    Frage: {query}

    Antworte als JSON-Array (leer wenn keine Eigennamen):
    ["Name1", "Name2"]

  document_extraction_prompt: |
    Analysiere den folgenden Textabschnitt aus einem Dokument und extrahiere benannte Entitaeten und ihre Beziehungen.

    Nur KONKRETE, BENANNTE Entitaeten mit echtem Namen extrahieren:
    - Personen (vollstaendiger Name, NICHT generische Rollen wie "Kunde" oder "Sachbearbeiter")
    - Orte (Staedte, Laender, Gebaeude — mit konkretem Namen)
    - Organisationen (Firmen, Vereine, Behoerden — mit konkretem Namen)
    - Dinge: konkrete Produkte MIT Eigenname: "iPhone 15", "Tesla Model 3" — NICHT generische Begriffe wie "Handy", "Auto", "Flatrate", "Messstellenbetrieb"
    - Ereignisse: konkrete, benannte Ereignisse: "Oktoberfest 2024" — NICHT generische Zeitangaben wie "Maerz 2013" oder "Dezember"
    - Konzepte: NUR persoenliche Hobbys, Studienfaecher, Berufsbezeichnungen — NICHT Dokumentfelder oder juristische Begriffe

    RELATIONEN extrahieren:
    - Persoenliche Beziehungen: "wohnt_in", "arbeitet_bei", "mag", "besitzt", "kennt", "ist_verheiratet_mit"
    - Dokumentbeziehungen: "sendet_an", "empfaengt_von", "adressiert_an", "unterzeichnet_von", "ausgestellt_von", "erstellt_fuer"
    - Geschaeftliche Beziehungen: "beauftragt", "liefert_an", "ist_kunde_von", "ist_mitglied_von", "vertritt"
    - Erkenne Absender/Empfaenger aus dem Dokumentkontext (Briefkopf, Anrede, Unterschrift, Adressfelder)
    - Auch IMPLIZITE Relationen aus der Dokumentstruktur extrahieren (z.B. Firma im Briefkopf + Person in der Anrede = "sendet_an")
    - confidence: 0.5-1.0 (wie sicher ist die Relation)

    IGNORIERE (NIEMALS als Entitaet extrahieren):
    - Formatierung, Seitenzahlen, Inhaltsverzeichnisse
    - Generische/unbenannte Verweise
    - OCR-Artefakte: Woerter mit ungewoehnlichen Leerzeichen ("F R E S E N"), unleserliche Fragmente, verstuemmelte Woerter
    - Bankverbindungen, IBANs, BICs, Kontonummern (z.B. "IBAN DE12...", "BIC DEUTDEMM")
    - Steueridentifikationsnummern, Umsatzsteuer-IDs (z.B. "DE811127597")
    - Generische Fusszeilentexte ("Gerichtsstand", "Handelsregister", "Registergericht")
    - URLs, E-Mail-Adressen, Telefonnummern, Faxnummern
    - Reine Nummern, Referenzcodes, Vertragsnummern, Aktenzeichen, Kundennummern
    - Datumsangaben als Entitaeten (nur in Beschreibungen verwenden)
    - Generische Rollen OHNE konkreten Namen ("Kunde", "Vermittler", "Sachbearbeiter", "Bediener", "Berater", "Vollziehungsbeamter")
    - Nummerierte Rollen ("Bediener 2", "Sachbearbeiter 3")
    - KEINE einzelnen deutschen Substantive die Dokumentfelder beschreiben: z.B. "Inkasso", "Flatrate", "Messstellenbetrieb", "Mahngebuehren", "Zahlungsbedingungen"
    - KEINE Geldbetraege oder Waehrungsangaben ("100 EUR", "0,04 Euro")
    - KEINE generischen Geschaeftsbegriffe ("Leistungserbringer", "Zahlungsdienstleister", "Vertragsnummer", "Abrechnungszeitraum")

    Text:
    {text}

    Antworte als JSON-Objekt (leere Arrays wenn nichts relevant):
    {{
      "entities": [{{"name": "...", "type": "person|place|organization|thing|event|concept", "description": "..."}}],
      "relations": [{{"subject": "...", "predicate": "...", "object": "...", "confidence": 0.8}}]
    }}

en:
  extraction_system: "You extract entities and relations from dialogs. Reply ONLY with a JSON object. No numbers, IDs, URLs, or OCR artifacts as entities. Only entities with concrete proper names."

  extraction_prompt: |
    Analyze the following dialog and extract named entities and their relationships.

    Only extract CONCRETE, NAMED entities — with real names or titles:
    - People (full names or nicknames, NOT generic roles)
    - Places (cities, countries, buildings — with concrete names)
    - Organizations (companies, clubs — with concrete names)
    - Things: concrete products WITH proper names: "iPhone 15", "Tesla Model 3" — NOT generic terms like "phone", "car", "flatrate", "meter operation"
    - Events: concrete, named events: "Oktoberfest 2024", "Christmas 2025" — NOT generic time references like "March 2013"
    - Concepts: ONLY personal hobbies, fields of study, job titles — NOT document fields or legal terms

    EXTRACT relations:
    - Relationships between entities ("lives_in", "works_at", "likes", "owns", "knows", "married_to")
    - Only relations EXPLICITLY mentioned in the dialog
    - confidence: 0.5-1.0 (how certain is the relation)

    IGNORE (NEVER extract as entity):
    - One-time commands ("Turn on the light")
    - Smalltalk without named entities
    - Information given BY the assistant (only facts FROM the user)
    - Generic roles WITHOUT concrete names ("customer", "clerk", "agent", "operator")
    - Numbers, IDs, reference codes, contract numbers, file numbers
    - URLs, email addresses, phone numbers
    - Dates as entities (use only in descriptions)
    - NO single nouns describing document fields: e.g. "collection", "flatrate", "meter operation", "late fees", "payment terms"
    - NO monetary amounts or currency references ("100 EUR", "0.04 Euro")
    - NO generic business terms ("service provider", "payment processor", "contract number", "billing period")

    Dialog:
    User: {user_message}
    Assistant: {assistant_response}

    Reply as JSON object (empty arrays if nothing relevant):
    {{
      "entities": [{{"name": "...", "type": "person|place|organization|thing|event|concept", "description": "..."}}],
      "relations": [{{"subject": "...", "predicate": "...", "object": "...", "confidence": 0.8}}]
    }}

  query_entities_system: "Extract entity names from questions. Reply ONLY with a JSON array of strings."

  query_entities_prompt: |
    Which specific people, places, organizations, or things are mentioned by name in this question?
    Only extract proper names, no generic terms.

    Question: {query}

    Reply as JSON array (empty if no proper names):
    ["Name1", "Name2"]

  document_extraction_prompt: |
    Analyze the following text passage from a document and extract named entities and their relationships.

    Only extract CONCRETE, NAMED entities with real names:
    - People (full names, NOT generic roles like "customer" or "clerk")
    - Places (cities, countries, buildings — with concrete names)
    - Organizations (companies, clubs, authorities — with concrete names)
    - Things: concrete products WITH proper names: "iPhone 15", "Tesla Model 3" — NOT generic terms like "phone", "car", "flatrate"
    - Events: concrete, named events: "Oktoberfest 2024" — NOT generic time references like "March 2013" or "December"
    - Concepts: ONLY personal hobbies, fields of study, job titles — NOT document fields or legal terms

    EXTRACT relations:
    - Personal relationships: "lives_in", "works_at", "likes", "owns", "knows", "married_to"
    - Document relationships: "sends_to", "receives_from", "addressed_to", "signed_by", "issued_by", "created_for"
    - Business relationships: "commissions", "supplies_to", "is_customer_of", "is_member_of", "represents"
    - Identify sender/recipient from document context (letterhead, salutation, signature, address fields)
    - Also extract IMPLIED relations from document structure (e.g. company in letterhead + person in salutation = "sends_to")
    - confidence: 0.5-1.0 (how certain is the relation)

    IGNORE (NEVER extract as entity):
    - Formatting, page numbers, tables of contents
    - Generic/unnamed references
    - OCR artifacts: words with unusual spacing ("F R E S E N"), illegible fragments, garbled words
    - Bank details, IBANs, BICs, account numbers (e.g. "IBAN DE12...", "BIC DEUTDEMM")
    - Tax IDs, VAT numbers (e.g. "DE811127597")
    - Generic footer text ("jurisdiction", "commercial register", "court of registry")
    - URLs, email addresses, phone numbers, fax numbers
    - Pure numbers, reference codes, contract numbers, file numbers, customer IDs
    - Dates as entities (use only in descriptions)
    - Generic roles WITHOUT concrete names ("customer", "agent", "clerk", "operator", "advisor")
    - Numbered roles ("Operator 2", "Clerk 3")
    - NO single nouns describing document fields: e.g. "collection", "flatrate", "meter operation", "late fees", "payment terms"
    - NO monetary amounts or currency references ("100 EUR", "0.04 Euro")
    - NO generic business terms ("service provider", "payment processor", "contract number", "billing period")

    Text:
    {text}

    Reply as JSON object (empty arrays if nothing relevant):
    {{
      "entities": [{{"name": "...", "type": "person|place|organization|thing|event|concept", "description": "..."}}],
      "relations": [{{"subject": "...", "predicate": "...", "object": "...", "confidence": 0.8}}]
    }}

# LLM options for extraction (low temperature for consistency)
llm_options:
  temperature: 0.1
  top_p: 0.2
  num_predict: 1024
  num_ctx: 4096
