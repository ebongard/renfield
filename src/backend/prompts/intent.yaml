# Intent Extraction Prompts
# Used by OllamaService.extract_intent()
# Supports multilingual prompts (de/en)
#
# NOTE: Intent types are now dynamically generated by IntentRegistry
# based on enabled integrations. This file contains only the prompt template.

de:
  # Main intent extraction prompt template
  # Available variables: {message}, {room_context}, {history_context}, {intent_types}, {entity_context}, {examples}, {correction_examples}
  extraction_prompt: |
    Erkenne den Intent für diese Nachricht: "{message}"
    {room_context}
    {history_context}

    INTENT-TYPEN:

    {intent_types}

    {entity_context}

    {examples}

    {correction_examples}

    ENTSCHEIDUNGSHILFE:
    - knowledge.ask / knowledge.search → NUR verwenden wenn der Nutzer EXPLIZIT auf die Renfield-Wissensdatenbank
      verweist ("in meiner Wissensdatenbank", "in meinen Notizen", "was habe ich gespeichert über")
    - general.conversation → Für Allgemeinwissen, Smalltalk, Meinungen, Erklärungen, historische Fakten,
      Wissenschaft, Geschichte, Philosophie, Mathematik und alles was aus Trainingsdaten beantwortet werden kann.
      ("Was passierte 1989 in China?", "Erkläre mir Quantenphysik", "Wie geht es dir?", "Wer war Einstein?",
       "Was ist die Relativitätstheorie?", "Wann wurde Deutschland vereint?")
    - mcp.search.web_search → NUR verwenden wenn der Nutzer EXPLIZIT nach einer Websuche fragt ("suche im Web",
      "google mal", "recherchiere") ODER wenn aktuelle/tagesaktuelle Informationen benötigt werden die sich
      häufig ändern ("aktueller Preis von...", "heutige Börsenkurse", "aktuelle Ergebnisse")
      NICHT verwenden für: Geschichte, Wissenschaft, Allgemeinwissen, Erklärungen — das kann aus Trainingsdaten beantwortet werden!
    - mcp.* Tools (außer search) → Wenn externe Dienste angesprochen werden:
      * "Nachrichten", "News", "Schlagzeilen" → mcp.news.search_articles / mcp.news.get_top_headlines
      * "Dokumente", "Rechnungen", "Belege", "Paperless" → mcp.paperless.search_documents / mcp.paperless.list_documents
      * "Workflow", "n8n", "Automatisierung" → mcp.n8n.n8n_list_workflows_summary / mcp.n8n.n8n_activate_workflow
      * "Wetter", "Temperatur", "Regen" → mcp.weather.weather_forecast
      * "Filme", "Serien", "Jellyfin", "Medien" → mcp.jellyfin.list_items / mcp.jellyfin.search_items
      * "Licht", "Schalter", "Heizung", Smart Home → mcp.homeassistant.HassTurnOn / HassTurnOff / etc.

    WICHTIG:
    - Verwende NUR Intents aus der Liste oben!
    - Antworte NUR mit JSON, kein Text!
    - Bei Unsicherheit: general.conversation verwenden
    - Gib bis zu 3 gewichtete Intents zurück, sortiert nach Wahrscheinlichkeit

    ANTWORT-FORMAT:
    {{"intents": [{{"intent": "...", "confidence": 0.8, "parameters": {{...}}}}, ...]}}

  # Room context template
  room_context_template: |
    RAUM-KONTEXT: Der Benutzer befindet sich im Raum '{room_name}'.
    Wenn der Benutzer 'das Licht' oder 'die Lampe' sagt ohne Raumnamen, bevorzuge Geräte im Raum '{room_name}'.

  # Speaker context template
  speaker_context_template: "SPRECHER: {speaker_name}"

  # Conversation history template for reference resolution
  history_context_template: |
    KONVERSATIONS-HISTORIE (für Referenz-Auflösung):
    {history_lines}

    WICHTIG bei Referenzen:
    - Wenn der Nutzer "dort", "da", "dorthin" sagt, beziehe es auf den letzten genannten ORT in der Historie
    - Wenn der Nutzer "es", "das", "die", "den" sagt, beziehe es auf das letzte OBJEKT/GERÄT
    - Ersetze Referenzen durch die konkreten Werte aus der Historie in den Parametern
    - Beispiel: Wenn vorher "Berlin" erwähnt wurde und der Nutzer "dort" sagt, nutze "Berlin" im Query

  # System message for JSON-only responses
  json_system_message: "Antworte nur mit JSON."

en:
  # Main intent extraction prompt template
  # Available variables: {message}, {room_context}, {history_context}, {intent_types}, {entity_context}, {examples}, {correction_examples}
  extraction_prompt: |
    Recognize the intent for this message: "{message}"
    {room_context}
    {history_context}

    INTENT TYPES:

    {intent_types}

    {entity_context}

    {examples}

    {correction_examples}

    DECISION GUIDE:
    - knowledge.ask / knowledge.search → ONLY use when the user EXPLICITLY references the Renfield knowledge base
      ("in my knowledge base", "in my notes", "what did I save about")
    - general.conversation → For general knowledge, smalltalk, opinions, explanations, historical facts,
      science, history, philosophy, math, and anything answerable from training data.
      ("What happened in 1989 in China?", "Explain quantum physics", "How are you?", "Who was Einstein?",
       "What is the theory of relativity?", "When was Germany reunified?")
    - mcp.search.web_search → ONLY use when the user EXPLICITLY asks for a web search ("search the web",
      "google it", "look it up online") OR when current/real-time information is needed that changes frequently
      ("current price of...", "today's stock market", "latest results")
      Do NOT use for: history, science, general knowledge, explanations — these can be answered from training data!
    - mcp.* tools (except search) → When external services are queried:
      * "news", "headlines", "articles" → mcp.news.search_articles / mcp.news.get_top_headlines
      * "documents", "invoices", "receipts", "Paperless" → mcp.paperless.search_documents / mcp.paperless.list_documents
      * "workflow", "n8n", "automation" → mcp.n8n.n8n_list_workflows_summary / mcp.n8n.n8n_activate_workflow
      * "weather", "temperature", "rain" → mcp.weather.weather_forecast
      * "movies", "series", "Jellyfin", "media" → mcp.jellyfin.list_items / mcp.jellyfin.search_items
      * "light", "switch", "heating", smart home → mcp.homeassistant.HassTurnOn / HassTurnOff / etc.

    IMPORTANT:
    - Use ONLY intents from the list above!
    - Reply with JSON ONLY, no text!
    - When uncertain: use general.conversation
    - Return up to 3 weighted intents, sorted by probability

    RESPONSE FORMAT:
    {{"intents": [{{"intent": "...", "confidence": 0.8, "parameters": {{...}}}}, ...]}}

  # Room context template
  room_context_template: |
    ROOM CONTEXT: The user is in the room '{room_name}'.
    When the user says 'the light' or 'the lamp' without a room name, prefer devices in '{room_name}'.

  # Speaker context template
  speaker_context_template: "SPEAKER: {speaker_name}"

  # Conversation history template for reference resolution
  history_context_template: |
    CONVERSATION HISTORY (for reference resolution):
    {history_lines}

    IMPORTANT for references:
    - When the user says "there", use the last mentioned LOCATION from history
    - When the user says "it", "this", "that", refer to the last OBJECT/DEVICE
    - Replace references with concrete values from history in parameters
    - Example: If "Berlin" was mentioned before and user says "there", use "Berlin" in query

  # System message for JSON-only responses
  json_system_message: "Reply with JSON only."

# Language-independent configuration
llm_options:
  temperature: 0.0
  top_p: 0.1
  num_predict: 500
  num_ctx: 32768
