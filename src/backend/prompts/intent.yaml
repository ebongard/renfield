# Intent Extraction Prompts
# Used by OllamaService.extract_intent()
# Supports multilingual prompts (de/en)
#
# NOTE: Intent types are now dynamically generated by IntentRegistry
# based on enabled integrations. This file contains only the prompt template.

de:
  # Main intent extraction prompt template
  # Available variables: {message}, {room_context}, {history_context}, {intent_types}, {entity_context}, {examples}, {correction_examples}
  extraction_prompt: |
    Erkenne den Intent für diese Nachricht: "{message}"
    {room_context}
    {history_context}

    INTENT-TYPEN:

    {intent_types}

    {entity_context}

    {examples}

    {correction_examples}

    ENTSCHEIDUNGSHILFE:
    - knowledge.ask / knowledge.search → NUR verwenden wenn der Nutzer EXPLIZIT auf die Renfield-Wissensdatenbank
      verweist ("in meiner Wissensdatenbank", "in meinen Notizen", "was habe ich gespeichert über")
    - general.conversation → Für Allgemeinwissen, Smalltalk, Meinungen, Erklärungen, historische Fakten
      ("Was passierte 1989?", "Erkläre mir Quantenphysik", "Wie geht es dir?", "Wer war Einstein?")
    - mcp.* Tools → Wenn aktuelle/live Daten benötigt werden ("Wetter morgen", "aktuelle Nachrichten",
      "was kostet X heute"), Geräte gesteuert werden sollen, oder externe Dienste angesprochen werden
      (Paperless-Dokumente, Workflows, Medien-Bibliothek, Websuche)
    - WICHTIG: Fragen zu "Dokumenten", "Rechnungen", "Belegen" ohne expliziten Wissensdatenbank-Bezug
      → mcp.paperless.* verwenden (NICHT knowledge.*)

    WICHTIG:
    - Verwende NUR Intents aus der Liste oben!
    - Antworte NUR mit JSON, kein Text!
    - Bei Unsicherheit: general.conversation verwenden
    - Gib bis zu 3 gewichtete Intents zurück, sortiert nach Wahrscheinlichkeit

    ANTWORT-FORMAT:
    {{"intents": [{{"intent": "...", "confidence": 0.8, "parameters": {{...}}}}, ...]}}

  # Room context template
  room_context_template: |
    RAUM-KONTEXT: Der Benutzer befindet sich im Raum '{room_name}'.
    Wenn der Benutzer 'das Licht' oder 'die Lampe' sagt ohne Raumnamen, bevorzuge Geräte im Raum '{room_name}'.

  # Speaker context template
  speaker_context_template: "SPRECHER: {speaker_name}"

  # Conversation history template for reference resolution
  history_context_template: |
    KONVERSATIONS-HISTORIE (für Referenz-Auflösung):
    {history_lines}

    WICHTIG bei Referenzen:
    - Wenn der Nutzer "dort", "da", "dorthin" sagt, beziehe es auf den letzten genannten ORT in der Historie
    - Wenn der Nutzer "es", "das", "die", "den" sagt, beziehe es auf das letzte OBJEKT/GERÄT
    - Ersetze Referenzen durch die konkreten Werte aus der Historie in den Parametern
    - Beispiel: Wenn vorher "Berlin" erwähnt wurde und der Nutzer "dort" sagt, nutze "Berlin" im Query

  # System message for JSON-only responses
  json_system_message: "Antworte nur mit JSON."

en:
  # Main intent extraction prompt template
  # Available variables: {message}, {room_context}, {history_context}, {intent_types}, {entity_context}, {examples}, {correction_examples}
  extraction_prompt: |
    Recognize the intent for this message: "{message}"
    {room_context}
    {history_context}

    INTENT TYPES:

    {intent_types}

    {entity_context}

    {examples}

    {correction_examples}

    DECISION GUIDE:
    - knowledge.ask / knowledge.search → ONLY use when the user EXPLICITLY references the Renfield knowledge base
      ("in my knowledge base", "in my notes", "what did I save about")
    - general.conversation → For general knowledge, smalltalk, opinions, explanations, historical facts
      ("What happened in 1989?", "Explain quantum physics", "How are you?", "Who was Einstein?")
    - mcp.* tools → When current/live data is needed ("weather tomorrow", "latest news",
      "what does X cost today"), devices need to be controlled, or external services are queried
      (Paperless documents, workflows, media library, web search)
    - IMPORTANT: Questions about "documents", "invoices", "receipts" without explicit knowledge base reference
      → use mcp.paperless.* (NOT knowledge.*)

    IMPORTANT:
    - Use ONLY intents from the list above!
    - Reply with JSON ONLY, no text!
    - When uncertain: use general.conversation
    - Return up to 3 weighted intents, sorted by probability

    RESPONSE FORMAT:
    {{"intents": [{{"intent": "...", "confidence": 0.8, "parameters": {{...}}}}, ...]}}

  # Room context template
  room_context_template: |
    ROOM CONTEXT: The user is in the room '{room_name}'.
    When the user says 'the light' or 'the lamp' without a room name, prefer devices in '{room_name}'.

  # Speaker context template
  speaker_context_template: "SPEAKER: {speaker_name}"

  # Conversation history template for reference resolution
  history_context_template: |
    CONVERSATION HISTORY (for reference resolution):
    {history_lines}

    IMPORTANT for references:
    - When the user says "there", use the last mentioned LOCATION from history
    - When the user says "it", "this", "that", refer to the last OBJECT/DEVICE
    - Replace references with concrete values from history in parameters
    - Example: If "Berlin" was mentioned before and user says "there", use "Berlin" in query

  # System message for JSON-only responses
  json_system_message: "Reply with JSON only."

# Language-independent configuration
llm_options:
  temperature: 0.0
  top_p: 0.1
  num_predict: 500
