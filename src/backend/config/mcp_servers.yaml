# MCP Server Configuration
# ========================
# Define external MCP servers that Renfield connects to as a client.
# Each server exposes tools that become available to the Agent Loop.
#
# Environment variable substitution:
#   ${VAR}           — Requires VAR to be set
#   ${VAR:-default}  — Uses "default" if VAR is not set
#
# Transport types:
#   streamable_http  — Modern MCP transport (default)
#   sse              — Server-Sent Events (legacy)
#   stdio            — Subprocess with stdin/stdout (requires Node.js)
#
# Examples:
#   Each server can define bilingual examples for the LLM intent prompt.
#   These help the LLM recognize when to use a server's tools.
#   examples:
#     de: ["Beispiel-Anfrage auf Deutsch"]
#     en: ["Example query in English"]
#
# prompt_tools:
#   Controls which tools are registered from this server.
#   Only listed tools are discovered, available in prompts, and executable.
#   Omit this field to register all tools of a server.
#   prompt_tools: [tool_name_1, tool_name_2]

servers:
  # --- OpenWeatherMap MCP Server ---
  # Replaces: plugins/weather.yaml
  # npm: @tristau/openweathermap-mcp
  # Requires: OPENWEATHER_API_KEY env var
  - name: weather
    transport: stdio
    command: npx
    args: ["-y", "@tristau/openweathermap-mcp", "--apikey", "${OPENWEATHER_API_KEY}"]
    enabled: "${WEATHER_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.weather.get_daily_forecast
    prompt_tools:
      - get_current_weather
      - get_daily_forecast
    examples:
      de:
        - "Wie wird das Wetter morgen?"
        - "Wettervorhersage für Berlin"
      en:
        - "What's the weather tomorrow?"
        - "Weather forecast for Berlin"

  # --- SearXNG MCP Server ---
  # Replaces: plugins/search.yaml
  # npm: @kevinwatt/mcp-server-searxng
  # Requires: SEARXNG_URL env var
  - name: search
    transport: stdio
    command: npx
    args: ["-y", "@kevinwatt/mcp-server-searxng"]
    enabled: "${SEARCH_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.search.web_search
    # No prompt_tools filter — search has only 1 tool
    examples:
      de:
        - "Suche im Web nach Python Tutorials"
        - "Was kostet ein Tesla Model 3?"
      en:
        - "Search the web for Python tutorials"
        - "What does a Tesla Model 3 cost?"

  # --- NewsAPI MCP Server ---
  # Replaces: plugins/news.yaml
  # npm: mcp-newsapi
  # Requires: NEWSAPI_KEY env var
  - name: news
    transport: stdio
    command: npx
    args: ["-y", "mcp-newsapi"]
    enabled: "${NEWS_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.news.search_articles
    prompt_tools:
      - search_articles
      - get_top_headlines
    examples:
      de:
        - "Was sind die aktuellen Nachrichten?"
        - "Nachrichten über KI"
      en:
        - "What are the latest news?"
        - "News about AI"

  # --- Jellyfin MCP Server ---
  # Custom Python MCP server with 13 specialized tools for Jellyfin.
  # Replaces: jellyfin-suggestion-mcp npm package + plugins/jellyfin.yaml
  # Requires: JELLYFIN_URL, JELLYFIN_API_KEY, JELLYFIN_USER_ID env vars
  - name: jellyfin
    transport: stdio
    command: python
    args: ["-m", "renfield_mcp_jellyfin"]
    enabled: "${JELLYFIN_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.jellyfin.search_media
    prompt_tools:
      - search_media
      - get_stream_url
      - list_albums
      - list_artists
      - list_movies
      - list_series
      - library_stats
    examples:
      de:
        - "Suche Musik von Queen"
        - "Spiele Pink Floyd im Wohnzimmer"
        - "Welche Alben habe ich von ZZ Top?"
        - "Welche Filme habe ich?"
      en:
        - "Search music by Queen"
        - "Play Pink Floyd in the living room"
        - "What albums do I have from ZZ Top?"
        - "What movies do I have?"

  # --- n8n MCP Server (Workflow Builder + Node Catalog) ---
  # npm: n8n-mcp (czlonkowski/n8n-mcp)
  # Provides: Workflow CRUD, node catalog (1,084+ nodes),
  #           template search (2,709 templates), validation + auto-fix
  # Requires: N8N_API_URL, N8N_API_KEY env vars
  # Get API key from: n8n → Settings → API → Create API Key
  - name: n8n
    transport: stdio
    command: npx
    args: ["-y", "n8n-mcp"]
    enabled: "${N8N_MCP_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.n8n.n8n_list_workflows
    prompt_tools:
      # Workflow Management
      - n8n_list_workflows
      - n8n_get_workflow
      - n8n_create_workflow
      - n8n_update_full_workflow
      - n8n_deploy_template
      # Execution
      - n8n_test_workflow
      - n8n_executions
      # Node Catalog
      - search_nodes
      - get_node
      - search_templates
      - get_template
      # Validation
      - n8n_validate_workflow
      - n8n_autofix_workflow
    examples:
      de:
        - "Erstell einen Workflow der jeden Montag das Wetter per Telegram schickt"
        - "Liste meine n8n Workflows"
        - "Welche n8n Nodes gibt es fuer Telegram?"
      en:
        - "Create a workflow that sends weather via Telegram every Monday"
        - "List my n8n workflows"
        - "What n8n nodes are available for Telegram?"

  # --- Paperless-NGX MCP Server ---
  # Custom Python MCP server with 2 tools for Paperless-NGX.
  # Replaces: @nloui/paperless-mcp npm package
  # Requires: PAPERLESS_API_URL, PAPERLESS_API_TOKEN env vars
  # Get API token from: Paperless-NGX → Profile → Auth Tokens
  - name: paperless
    transport: stdio
    command: python
    args: ["-m", "renfield_mcp_paperless"]
    enabled: "${PAPERLESS_ENABLED:-false}"
    refresh_interval: 300
    example_intent: mcp.paperless.search_documents
    prompt_tools:
      - search_documents
      - download_document
    examples:
      de:
        - "Zeige meine Dokumente in Paperless"
        - "Suche nach Rechnungen in Paperless"
      en:
        - "Show my documents in Paperless"
        - "Search for invoices in Paperless"

  # --- Home Assistant MCP Server ---
  # Uses HA's built-in MCP server at /api/mcp
  # Requires: MCP Server integration enabled in HA
  - name: homeassistant
    transport: streamable_http
    url: "${HOME_ASSISTANT_URL}/api/mcp"
    auth_token_env: HOME_ASSISTANT_TOKEN
    enabled: "${HA_MCP_ENABLED:-false}"
    refresh_interval: 600
    example_intent: mcp.homeassistant.GetLiveContext
    prompt_tools:
      - HassTurnOn
      - HassTurnOff
      - HassLightSet
      - GetLiveContext
      - HassSetPosition
      - HassMediaSearchAndPlay
      - HassSetVolume
    examples:
      de:
        - "Schalte das Licht im Wohnzimmer ein"
        - "Wie warm ist es im Büro?"
      en:
        - "Turn on the living room light"
        - "How warm is it in the office?"
